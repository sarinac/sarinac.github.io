<!doctype html><html><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><title>College Football | If Colorful</title><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content="Sarina Chen"><meta name=description content="Portfolio of Sarina Chen"><meta property="og:description" content="Portfolio of Sarina Chen"><meta property="og:image" content="https://ifcolorful.com/_general/preview.png"><meta name=twitter:image content="https://ifcolorful.com/_general/preview.png"><link rel=icon href=https://ifcolorful.com/_general/favicon.svg type=image/x-icon><link rel="shortcut icon" href=https://ifcolorful.com/_general/favicon.svg type=image/x-icon><link rel=stylesheet href=/css/main.css></head><body><nav class=main-navigation><a href=https://ifcolorful.com/ class=main-navigation-logo><svg id="ifcolorful-logo" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 356.0831 71.2166"><defs><style>.gray{fill:#648585}.yellow{fill:#eaac61}.green{fill:#20cc94}.blue{fill:#00a1e1}.purple{fill:#a58eff}.text{fill:#f7f8f9}</style></defs><rect class="gray" width="71.2166" height="71.2166"/><rect class="yellow" x="71.2166" width="71.2166" height="71.2166"/><rect class="green" x="142.4333" width="71.2166" height="71.2166"/><rect class="blue" x="213.6499" width="71.2166" height="71.2166"/><rect class="purple" x="284.8665" width="71.2166" height="71.2166"/><path class="text" d="M141.8116 321.0127H137.24V294.4416h-8.993v-3.9549h13.5645zm-2.2282-42.07a2.9723 2.9723.0 012.1987.9228 3.0455 3.0455.0 01.9068 2.2121 3.0867 3.0867.0 01-.8934 2.2563 2.9826 2.9826.0 01-2.2121.9082 2.8769 2.8769.0 01-2.1239-.9523 3.0826 3.0826.0 01-.9229-2.2122 3.0341 3.0341.0 01.9229-2.1974A2.9006 2.9006.0 01139.5834 278.9432z" transform="translate(-121.9584 -264.3917)"/><path class="text" d="M185.7254 280.1442l-1.201 3.7208a21.3234 21.3234.0 00-5.8313-.9376q-2.46.0-3.3837 1.3923-.923 1.39-.9229 5.6093v.5577h10.2556v3.9549H174.3865v26.5711h-4.5687V294.4416h-7.677v-3.9549h7.677v-1.0258q0-5.83 1.9928-8.1732 1.99-2.3452 6.8825-2.3445A23.9489 23.9489.0 01185.7254 280.1442z" transform="translate(-121.9584 -264.3917)"/><path class="text" d="M221.3231 319.9869a20.8687 20.8687.0 01-8.76 1.8162q-7.2063.0-11.5-4.3788t-4.2905-11.6452q0-7.2663 4.32-11.6452a15.24 15.24.0 0111.3523-4.38 24.0535 24.0535.0 018.76 1.6116l-1.2011 3.7783a23.2883 23.2883.0 00-7.5-1.4351 10.24 10.24.0 00-7.9846 3.2514q-2.941 3.252-2.9424 8.8191a12.5193 12.5193.0 003.0467 8.5691 10.0611 10.0611.0 007.9392 3.4707 23.2013 23.2013.0 007.9685-1.494z" transform="translate(-121.9584 -264.3917)"/><path class="text" d="M245.6085 289.7538a12.4492 12.4492.0 0110.0175 4.3948q3.72 4.3936 3.7208 11.5717.0 7.2363-3.7208 11.66a13.5892 13.5892.0 01-20.051.0147q-3.7075-4.41-3.7075-11.6746.0-7.2062 3.7208-11.5864A12.4722 12.4722.0 01245.6085 289.7538zm0 28.0651a7.5465 7.5465.0 006.5616-3.5149 16.6768 16.6768.0 00.0294-17.1969 8.1238 8.1238.0 00-13.1846-.0441 17.0166 17.0166.0 00.0294 17.2852A7.526 7.526.0 00245.6085 317.8189z" transform="translate(-121.9584 -264.3917)"/><path class="text" d="M291.221 321.0127H278.74V283.6309h-7.9686v-3.9548h12.54v37.3818h7.91z" transform="translate(-121.9584 -264.3917)"/><path class="text" d="M317.6169 289.7538a12.4492 12.4492.0 0110.0175 4.3948q3.72 4.3936 3.7208 11.5717.0 7.2363-3.7208 11.66a13.5892 13.5892.0 01-20.051.0147q-3.7075-4.41-3.7075-11.6746.0-7.2062 3.7208-11.5864A12.4722 12.4722.0 01317.6169 289.7538zm0 28.0651a7.5465 7.5465.0 006.5616-3.5149 16.6768 16.6768.0 00.0294-17.1969 8.1238 8.1238.0 00-13.1846-.0441 17.0166 17.0166.0 00.0294 17.2852A7.526 7.526.0 00317.6169 317.8189z" transform="translate(-121.9584 -264.3917)"/><path class="text" d="M365.9283 291.3066l-1.8456 4.3948a13.4166 13.4166.0 00-5.2161-1.3187 7.5988 7.5988.0 00-3.9535 1.1569 12.6727 12.6727.0 00-3.56 3.31 11.9579 11.9579.0 00-1.6263 2.4168v19.7461h-4.542v-30.526h4.542v6.18q3.6632-6.9134 9.4932-6.9133A15.4094 15.4094.0 01365.9283 291.3066z" transform="translate(-121.9584 -264.3917)"/><path class="text" d="M401.756 280.1442l-1.201 3.7208a21.3245 21.3245.0 00-5.8313-.9376q-2.46.0-3.3838 1.3923-.9228 1.39-.9228 5.6093v.5577h10.2556v3.9549H390.4171v26.5711h-4.5687V294.4416h-7.677v-3.9549h7.677v-1.0258q0-5.83 1.9928-8.1732 1.99-2.3452 6.8825-2.3445A23.9489 23.9489.0 01401.756 280.1442z" transform="translate(-121.9584 -264.3917)"/><path class="text" d="M437.4071 321.0127h-4.5687v-4.5112q-4.9231 5.2441-10.3706 5.2441-8.5865.0-8.5838-10.4V290.4867h4.5687v19.54a10.958 10.958.0 001.2305 5.8152 4.5627 4.5627.0 004.1622 1.9193q4.1889.0 8.993-5.2148v-22.06h4.5687z" transform="translate(-121.9584 -264.3917)"/><path class="text" d="M471.2446 321.0127H458.7635V283.6309H450.795v-3.9548h12.54v37.3818h7.91z" transform="translate(-121.9584 -264.3917)"/></svg></a><div class=sub-navigation><a href=https://ifcolorful.com/about class=sub-navigation-link id=nav-about>About</a>
<a href=https://ifcolorful.com/showcase class=sub-navigation-link id=nav-showcase>Showcase</a>
<a href=https://ifcolorful.com/projects class=sub-navigation-link id=nav-all-projects>All Projects</a></div></nav><div class="content-wrapper project-description"><div class=showcase-summary><div class=showcase-summary-left><div class=showcase-summary-subtitle><p>Networks & Visualization</p></div><div class=showcase-summary-title><h1>College Football</h1></div><div class=showcase-summary-description><p>I used BeautifulSoup to web-scrape and NetworkX to find the longest chain of losses within each conference to create the grand "Circle of Suck" visualization.</p></div><div class=showcase-summary-buttons><div class=showcase-summary-button><a href=https://collegefootball.ifcolorful.com class=check-it-out>Check It Out</a></div><div class=showcase-summary-button><a href=https://github.com/sarinac/college-football class=check-it-out>See Code</a></div></div></div><div class=showcase-summary-right><div class=showcase-summary-tool><p>BeautifulSoup</p></div><div class=showcase-summary-tool><p>Pandas</p></div><div class=showcase-summary-tool><p>NetworkX</p></div><div class=showcase-summary-tool><p>D3.js</p></div><div class=showcase-summary-tool><p>Web Workers</p></div></div></div><div class=showcase-picture style=background-image:url(https://ifcolorful.com/projects/college-football/cover.png)></div><h1 id=overview>Overview</h1><p>I drew the &ldquo;Circle of Suck&rdquo; for NCAA college football conferences for 2019 as a joke on my boyfriend&rsquo;s obsession with USC football. The <a href="https://twitter.com/redditcfb/status/1049717556184043521?lang=en">Circle of Suck</a> is complete when all the schools in a conference loses to another school (school A &lt; school B &lt; school C &mldr; &lt; school A). I usually see people scramble to post these jokes on Twitter, Reddit, and Facebook.</p><p>This visual has a green chalkboard background that alludes to both a grassy football field and a classroom. There are chalk-drawn circles indicating the 11 conferences with arrows showing which games form the Circle of Suck. You can easily find a team by searching for the conference first and then looking inside the circle if the team belongs to the conference or looking near the circle if the team mostly plays against other teams in a particular conference. When you hover over a school, all their games will show up as green (wins) or red (losses) links connecting to the opposing school.</p><h1 id=web-scraping-with-beautifulsoup>Web-Scraping with BeautifulSoup</h1><p>I used <a href=https://www.crummy.com/software/BeautifulSoup/bs4/doc/><code>BeautifulSoup</code></a> to web-scrape the NCAA football website, which has a <a href=https://www.ncaa.com/scoreboard/football/fbs/2019/01>home page</a> for all the matches by week and a <a href=https://www.ncaa.com/game/3785117>deep-dive</a> for each game. <code>BeautifulSoup</code> helped me get school colors and logo for each team, but both came in different challenges.</p><h3 id=getting-colors-from-the-css-style-section>Getting colors from the CSS style section</h3><p>Each team&rsquo;s primary and secondary colors were found in the <code>div.gamecenter-game-banner</code> section in the HTML for <a href=https://www.ncaa.com/game/3785117>each game</a>. Usually, <code>BeautifulSoup</code> is easy for getting the inner HTML or the value, but the colors were part of the CSS, in the <code>&lt;style></code> element, which required a workaround. I imported another library called <code>cssutils</code> to help me parse CSS. My code below shows how I parsed the CSS to get the correct class and <code>fill</code> attribute in a Python <code>dict</code> structure.</p><div class=highlight><pre style=color:#272822;background-color:#fafafa;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-python data-lang=python><span style=color:#75715e># Parse css for colors</span>
<span style=color:#111>selectors</span> <span style=color:#f92672>=</span> <span style=color:#111>{}</span>
<span style=color:#00a8c8>for</span> <span style=color:#111>styletag</span> <span style=color:#f92672>in</span> <span style=color:#111>soup</span><span style=color:#f92672>.</span><span style=color:#111>select</span><span style=color:#111>(</span><span style=color:#d88200>&#34;style&#34;</span><span style=color:#111>):</span>
    <span style=color:#111>css</span> <span style=color:#f92672>=</span> <span style=color:#111>cssutils</span><span style=color:#f92672>.</span><span style=color:#111>parseString</span><span style=color:#111>(</span><span style=color:#111>styletag</span><span style=color:#f92672>.</span><span style=color:#111>encode_contents</span><span style=color:#111>())</span>
    <span style=color:#00a8c8>for</span> <span style=color:#111>rule</span> <span style=color:#f92672>in</span> <span style=color:#111>css</span><span style=color:#111>:</span>
        <span style=color:#00a8c8>if</span> <span style=color:#111>rule</span><span style=color:#f92672>.</span><span style=color:#111>type</span> <span style=color:#f92672>==</span> <span style=color:#111>rule</span><span style=color:#f92672>.</span><span style=color:#111>STYLE_RULE</span><span style=color:#111>:</span>
            <span style=color:#111>style</span> <span style=color:#f92672>=</span> <span style=color:#111>rule</span><span style=color:#f92672>.</span><span style=color:#111>selectorText</span>
            <span style=color:#111>selectors</span><span style=color:#111>[</span><span style=color:#111>style</span><span style=color:#111>]</span> <span style=color:#f92672>=</span> <span style=color:#111>{}</span>
            <span style=color:#00a8c8>for</span> <span style=color:#111>item</span> <span style=color:#f92672>in</span> <span style=color:#111>rule</span><span style=color:#f92672>.</span><span style=color:#111>style</span><span style=color:#111>:</span>
                <span style=color:#111>propertyname</span> <span style=color:#f92672>=</span> <span style=color:#111>item</span><span style=color:#f92672>.</span><span style=color:#111>name</span>
                <span style=color:#111>value</span> <span style=color:#f92672>=</span> <span style=color:#111>item</span><span style=color:#f92672>.</span><span style=color:#111>value</span>
                <span style=color:#111>selectors</span><span style=color:#111>[</span><span style=color:#111>style</span><span style=color:#111>][</span><span style=color:#111>propertyname</span><span style=color:#111>]</span> <span style=color:#f92672>=</span> <span style=color:#111>value</span>

<span style=color:#00a8c8>print</span><span style=color:#111>(</span><span style=color:#111>selectors</span><span style=color:#f92672>.</span><span style=color:#111>get</span><span style=color:#111>(</span><span style=color:#d88200>&#34;.homeTeam-fill-primary_color&#34;</span><span style=color:#111>)</span><span style=color:#f92672>.</span><span style=color:#111>get</span><span style=color:#111>(</span><span style=color:#d88200>&#34;fill&#34;</span><span style=color:#111>,</span> <span style=color:#d88200>&#34;#fff&#34;</span><span style=color:#111>))</span> <span style=color:#75715e># Returns #003087</span>
<span style=color:#00a8c8>print</span><span style=color:#111>(</span><span style=color:#111>selectors</span><span style=color:#f92672>.</span><span style=color:#111>get</span><span style=color:#111>(</span><span style=color:#d88200>&#34;.homeTeam-fill-secondary_color&#34;</span><span style=color:#111>)</span><span style=color:#f92672>.</span><span style=color:#111>get</span><span style=color:#111>(</span><span style=color:#d88200>&#34;fill&#34;</span><span style=color:#111>,</span> <span style=color:#d88200>&#34;#fff&#34;</span><span style=color:#111>))</span> <span style=color:#75715e># Returns #00266c</span>
<span style=color:#00a8c8>print</span><span style=color:#111>(</span><span style=color:#111>selectors</span><span style=color:#f92672>.</span><span style=color:#111>get</span><span style=color:#111>(</span><span style=color:#d88200>&#34;.awayTeam-fill-primary_color&#34;</span><span style=color:#111>)</span><span style=color:#f92672>.</span><span style=color:#111>get</span><span style=color:#111>(</span><span style=color:#d88200>&#34;fill&#34;</span><span style=color:#111>,</span> <span style=color:#d88200>&#34;#fff&#34;</span><span style=color:#111>))</span> <span style=color:#75715e># Returns #154734</span>
<span style=color:#00a8c8>print</span><span style=color:#111>(</span><span style=color:#111>selectors</span><span style=color:#f92672>.</span><span style=color:#111>get</span><span style=color:#111>(</span><span style=color:#d88200>&#34;.awayTeam-fill-secondary_color&#34;</span><span style=color:#111>)</span><span style=color:#f92672>.</span><span style=color:#111>get</span><span style=color:#111>(</span><span style=color:#d88200>&#34;fill&#34;</span><span style=color:#111>,</span> <span style=color:#d88200>&#34;#fff&#34;</span><span style=color:#111>))</span> <span style=color:#75715e># Returns #103829</span>
</code></pre></div><h3 id=downloading-images-programatically>Downloading images programatically</h3><p>I used Python&rsquo;s <code>os</code> library to create a subdirectory and store my downloaded SVG images, for which I found the filepath using <code>BeautifulSoup</code>. However, it was only saving empty and broken files because <code>BeautifulSoup</code> reads static text and wasn&rsquo;t actually accessing the image file from the network. The remedy was to use <a href=https://docs.python.org/3/library/urllib.request.html#urllib.request.urlretrieve><code>urlretrieve</code></a> from the <code>urllib.request</code> library which takes care of using network connections to open URLs.</p><p>My code below shows how I programatically downloaded SVG files using <code>urllib.request</code>. I also had to download for the <code>home</code> and <code>away</code> classes and convert them into a &ldquo;winner&rdquo; and &ldquo;loser&rdquo; for my analysis.</p><div class=highlight><pre style=color:#272822;background-color:#fafafa;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-python data-lang=python><span style=color:#00a8c8>for</span> <span style=color:#111>side</span> <span style=color:#f92672>in</span> <span style=color:#111>sides</span><span style=color:#111>:</span>
    <span style=color:#111>team</span> <span style=color:#f92672>=</span> <span style=color:#111>sides</span><span style=color:#f92672>.</span><span style=color:#111>get</span><span style=color:#111>(</span><span style=color:#111>side</span><span style=color:#111>)</span>
    <span style=color:#00a8c8>if</span> <span style=color:#f92672>not</span> <span style=color:#111>os</span><span style=color:#f92672>.</span><span style=color:#111>path</span><span style=color:#f92672>.</span><span style=color:#111>exists</span><span style=color:#111>(</span><span style=color:#111>f</span><span style=color:#d88200>&#34;{folder_name}/{team}.svg&#34;</span><span style=color:#111>):</span>
        <span style=color:#111>image_link</span> <span style=color:#f92672>=</span> <span style=color:#111>(</span>
            <span style=color:#111>f</span><span style=color:#d88200>&#34;https:{banner.find(&#39;div&#39;, attrs={&#39;class&#39;: side}).img[&#39;src&#39;]}&#34;</span>
        <span style=color:#111>)</span>
        <span style=color:#111>urlretrieve</span><span style=color:#111>(</span><span style=color:#111>image_link</span><span style=color:#111>,</span> <span style=color:#111>f</span><span style=color:#d88200>&#34;{folder_name}/{team}.svg&#34;</span><span style=color:#111>)</span>
</code></pre></div><h3 id=other-nuances-with-web-scraping>Other nuances with web-scraping</h3><p>In addition to finding games, I also had to scrape the <a href=https://www.ncaa.com/standings/football/fbs>Standings Page</a> to know the conferences, which apparently wasn&rsquo;t listed elsewhere.</p><p>After obtaining the team and game information and images, I also had to do some manual cleanup with names because some names were inconsistent across pages (e.g. &ldquo;St.&rdquo; and &ldquo;State&rdquo;; &ldquo;FLA&rdquo;, &ldquo;FL&rdquo;, and &ldquo;Florida&rdquo;).</p><h1 id=finding-the-circle-of-suck-with-networkx>Finding the Circle of Suck with NetworkX</h1><p>To find the Circle of Suck or get the longest chain if it didn&rsquo;t exist, I created a directed graph with <a href=https://networkx.org/documentation/stable/index.html><code>Networkx</code></a> to compute the longest cycle in a given conference. <code>Networkx</code> has a convenient method called <code>simple_cycles</code> that returns an elementary circuit, or a closed path with no repeats. I sorted all the computed cycles by their lengths in decreasing order. If the first cycle&rsquo;s length is equal to the number of teams in a conference, we will know that the Circle of Suck is complete. Otherwise, we would have the longest chain of losses prior to the Circle of Suck&rsquo;s completion.</p><p>I also used the <code>draw_networkx</code> method to visualize what each conference would look like in a <code>circular_layout</code>. However, I can&rsquo;t order the nodes in a particular order, which is why they&rsquo;re not arranged in the &ldquo;correct&rdquo; order. That will change with D3 because I assigned each team an index within their conference which determines their placement.</p><p><img src=networkx.png alt></p><h1 id=visualizing-with-d3>Visualizing with D3</h1><h3 id=using-imported-svg>Using imported SVG</h3><p>As with almost all my projects, I scrapped my initial design because I underestimated the volume and complexity of my data. Showing everything and too many things at once does not look good. This kind of looks like my hairbrush lol.</p><p><img src=scratch-work.png alt></p><p>I changed my background to a black chalkboard and then a green chalkboard to invert the link colors, which I think look better and thematic as white chalk, which I created with a <a href=https://developer.mozilla.org/en-US/docs/Web/SVG/Element/defs>filter</a>. I also replaced the circles from the first visual with team logos, but you can see my mistake here due to lack of resizing.</p><p><img src=all-logos.png alt></p><p>In order to resize my image that I inserted using D3, I used this code block based on a <a href=https://stackoverflow.com/questions/14567809/how-to-add-an-image-to-an-svg-container-using-d3-js>StackOverflow post</a>. I thought this was pretty difficult in terms of reverse engineering and validating because this is different from the usual way of appending shapes using D3.</p><div class=highlight><pre style=color:#272822;background-color:#fafafa;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-javascript data-lang=javascript><span style=color:#75af00>selection</span>
	<span style=color:#111>.</span><span style=color:#75af00>append</span><span style=color:#111>(</span><span style=color:#d88200>&#34;image&#34;</span><span style=color:#111>)</span>
	    <span style=color:#111>.</span><span style=color:#75af00>attr</span><span style=color:#111>(</span><span style=color:#d88200>&#34;x&#34;</span><span style=color:#111>,</span> <span style=color:#75af00>d</span> <span style=color:#111>=&gt;</span> <span style=color:#75af00>d</span><span style=color:#111>.</span><span style=color:#75af00>x</span><span style=color:#111>)</span>
	    <span style=color:#111>.</span><span style=color:#75af00>attr</span><span style=color:#111>(</span><span style=color:#d88200>&#34;y&#34;</span><span style=color:#111>,</span> <span style=color:#75af00>d</span> <span style=color:#111>=&gt;</span> <span style=color:#75af00>d</span><span style=color:#111>.</span><span style=color:#75af00>y</span>
	    <span style=color:#111>.</span><span style=color:#75af00>attr</span><span style=color:#111>(</span><span style=color:#d88200>&#34;height&#34;</span><span style=color:#111>,</span> <span style=color:#75af00>height</span><span style=color:#111>)</span>
	    <span style=color:#111>.</span><span style=color:#75af00>attr</span><span style=color:#111>(</span><span style=color:#d88200>&#34;viewBox&#34;</span><span style=color:#111>,</span> <span style=color:#d88200>`0 0 </span><span style=color:#d88200>${</span><span style=color:#75af00>width</span><span style=color:#d88200>}</span><span style=color:#d88200> </span><span style=color:#d88200>${</span><span style=color:#75af00>height</span><span style=color:#d88200>}</span><span style=color:#d88200>`</span><span style=color:#111>)</span>                   <span style=color:#75715e>// use this is resize the SVG
</span><span style=color:#75715e></span>	    <span style=color:#111>.</span><span style=color:#75af00>attr</span><span style=color:#111>(</span><span style=color:#d88200>&#34;xlink:href&#34;</span><span style=color:#111>,</span> <span style=color:#75af00>d</span> <span style=color:#111>=&gt;</span> <span style=color:#d88200>`img/tooltip/</span><span style=color:#d88200>${</span><span style=color:#75af00>d</span><span style=color:#111>.</span><span style=color:#75af00>image_name</span><span style=color:#d88200>}</span><span style=color:#d88200>.svg`</span><span style=color:#111>)</span>  <span style=color:#75715e>// this is like &#34;src&#34; in the img element
</span></code></pre></div><p>While I was able to insert all my SVGs, I still thought they looked too &ldquo;solid&rdquo; and &ldquo;perfect&rdquo; against the chalk-drawn background. So then I wondered if it was possible to <strong>alter the inline SVGs after injecting them</strong>. This required me to approach this problem differently because I needed to read the code in the SVG files rather than pointing to their addresses.</p><p>My research yielded 2 ways to read the SVG&rsquo;s text:</p><ol><li>Use <code>d3.xml</code> (<a href=http://zevross.com/blog/2019/08/20/load-external-svgs-with-d3-v5/>see example</a>)</li><li>Use <code>fetch</code> (<a href=https://stackoverflow.com/questions/45240363/can-i-use-javascript-fetch-to-insert-an-inline-svg-in-the-dom>see example</a>)</li></ol><p>Both examples I found didn&rsquo;t fit my use case exactly, so I had to experiment. I chose <code>fetch</code> because I knew I could ask some JS literate friends about <a href=https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API/Using_Fetch><code>fetch</code></a>. When I first used the asynchronous <code>fetch</code>, I was so confused on why my logs were showing &ldquo;pending&rdquo; Promises instead of the actual SVG text. This meant that I was logging before the script finished retreiving and reading the file, which meant that it wasn&rsquo;t usable if I were to pass it to a callback function. After more research, I learned that I could use the <code>Promise</code> object to make sure <code>fetch</code> would complete before running the next step.</p><p>This code below shows my 3-step process using <code>.then()</code> (although <code>async/await</code> is a cleaner way of writing that I have yet to explore):</p><ol><li>Make sure all <code>fetch</code> methods (stored in an Array called <code>fetches</code>) are complete.</li><li>Make sure to get the &ldquo;text&rdquo; attribute from every response (apparently that needs a promise too, since it&rsquo;s still a result of <code>fetch</code>).</li><li>Use the text <code>data</code> in a callback.</li></ol><div class=highlight><pre style=color:#272822;background-color:#fafafa;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-javascript data-lang=javascript><span style=color:#111>Promise</span><span style=color:#111>.</span><span style=color:#75af00>all</span><span style=color:#111>(</span><span style=color:#75af00>fetches</span><span style=color:#111>)</span>
    <span style=color:#111>.</span><span style=color:#75af00>then</span><span style=color:#111>((</span><span style=color:#75af00>responses</span><span style=color:#111>)</span> <span style=color:#111>=&gt;</span> <span style=color:#111>{</span>
        <span style=color:#00a8c8>return</span> <span style=color:#111>Promise</span><span style=color:#111>.</span><span style=color:#75af00>all</span><span style=color:#111>(</span><span style=color:#75af00>responses</span><span style=color:#111>.</span><span style=color:#75af00>map</span><span style=color:#111>(</span><span style=color:#75af00>res</span> <span style=color:#111>=&gt;</span> <span style=color:#75af00>res</span><span style=color:#111>.</span><span style=color:#75af00>text</span><span style=color:#111>()))</span>  
    <span style=color:#111>})</span>
    <span style=color:#111>.</span><span style=color:#75af00>then</span><span style=color:#111>((</span><span style=color:#75af00>data</span><span style=color:#111>)</span> <span style=color:#111>=&gt;</span> <span style=color:#111>{</span>
        
        <span style=color:#75715e>// Post message back
</span><span style=color:#75715e></span>        <span style=color:#75af00>postMessage</span><span style=color:#111>({</span>
            <span style=color:#75af00>nodes</span><span style=color:#f92672>:</span> <span style=color:#75af00>event</span><span style=color:#111>.</span><span style=color:#75af00>data</span><span style=color:#111>.</span><span style=color:#75af00>nodes</span><span style=color:#111>,</span> 
            <span style=color:#75af00>links</span><span style=color:#f92672>:</span> <span style=color:#75af00>event</span><span style=color:#111>.</span><span style=color:#75af00>data</span><span style=color:#111>.</span><span style=color:#75af00>links</span><span style=color:#111>,</span>
            <span style=color:#75af00>images</span><span style=color:#f92672>:</span> <span style=color:#75af00>data</span><span style=color:#111>,</span>
        <span style=color:#111>});</span>
    <span style=color:#111>});</span>
</code></pre></div><p>I can then add the SVG&rsquo;s text as a DOM element&rsquo;s <code>innerHTML</code>, select it using D3, and manipulate it. Since I was adding 1 SVG per team, I applied the chalk filter to the <code>&lt;g></code> element containing all the teams, which applied the filter to all my images.</p><div class=highlight><pre style=color:#272822;background-color:#fafafa;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-javascript data-lang=javascript><span style=color:#75715e>// Add SVG&#39;s text as innerHTML
</span><span style=color:#75715e></span><span style=color:#111>document</span><span style=color:#111>.</span><span style=color:#75af00>getElementById</span><span style=color:#111>(</span><span style=color:#d88200>&#34;node&#34;</span><span style=color:#111>).</span><span style=color:#75af00>innerHTML</span> <span style=color:#f92672>=</span> <span style=color:#75af00>data</span><span style=color:#111>;</span>

<span style=color:#75715e>// Alter the SVG
</span><span style=color:#75715e></span><span style=color:#75af00>d3</span><span style=color:#111>.</span><span style=color:#75af00>select</span><span style=color:#111>(</span><span style=color:#d88200>&#34;node&#34;</span><span style=color:#111>)</span>
    <span style=color:#111>.</span><span style=color:#75af00>attr</span><span style=color:#111>(</span><span style=color:#d88200>&#34;height&#34;</span><span style=color:#111>,</span> <span style=color:#ae81ff>30</span><span style=color:#111>)</span> <span style=color:#75715e>// Change the height of SVG using D3
</span></code></pre></div><p>Here&rsquo;s a comparison where the teams on the left are altered with the chalk filter and teams on the right are just imported and resized images. My favorite difference is Florida Gators because the green blends in with the background.</p><p><img src=comparison.png alt></p><h3 id=running-simulation-on-web-workers>Running Simulation on Web Workers</h3><p>I played a lot with node placement, but the conferences were clumped too awkwardly, leaving big gaps of tiny non-conference teams in the center. After a long week of experimentation of customizing forces, I ended up creating fixed values by setting <code>fx</code> and <code>fy</code> attributes for the conferences in order to make both conferences and teams distribute evenly. This looked the best, and it was an opportunity for me to read the d3.js source code to understand how forces really worked.</p><p>Another problem I faced was performance because I was making a lot of images move on each tick. In my first attempt, I did not add the images until the simulation determined every team&rsquo;s final placement. However, I read online that people were using <a href=https://developer.mozilla.org/en-US/docs/Web/API/Web_Workers_API>Web Workers</a> to boost D3 performance, especially for static charts. Mike Bostock already provided an easy-to-follow <a href=https://bl.ocks.org/mbostock/01ab2e85e8727d6529d20391c0fd9a16>template</a> that helped me get started.</p><p>This was the only additional skeleton I added to my main script.</p><div class=highlight><pre style=color:#272822;background-color:#fafafa;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-javascript data-lang=javascript><span style=color:#75715e>// Create a worker which references your worker JS script
</span><span style=color:#75715e></span><span style=color:#00a8c8>var</span> <span style=color:#75af00>worker</span> <span style=color:#f92672>=</span> <span style=color:#00a8c8>new</span> <span style=color:#75af00>Worker</span><span style=color:#111>(</span><span style=color:#d88200>&#34;worker.js&#34;</span><span style=color:#111>);</span>

<span style=color:#75715e>// Post data to your worker
</span><span style=color:#75715e></span><span style=color:#75af00>worker</span><span style=color:#111>.</span><span style=color:#75af00>postMessage</span><span style=color:#111>({</span>
  <span style=color:#75af00>nodes</span><span style=color:#f92672>:</span> <span style=color:#75af00>nodes</span><span style=color:#111>,</span>
  <span style=color:#75af00>links</span><span style=color:#f92672>:</span> <span style=color:#75af00>links</span>
<span style=color:#111>});</span>

<span style=color:#75715e>// Get data that the worker sends back and run the rest of script with that data
</span><span style=color:#75715e></span><span style=color:#75af00>worker</span><span style=color:#111>.</span><span style=color:#75af00>onmessage</span> <span style=color:#f92672>=</span> <span style=color:#00a8c8>function</span><span style=color:#111>(</span><span style=color:#75af00>event</span><span style=color:#111>)</span> <span style=color:#111>{</span>
  <span style=color:#75af00>runRestOfScript</span><span style=color:#111>(</span><span style=color:#75af00>event</span><span style=color:#111>)</span>
<span style=color:#111>};</span>
</code></pre></div><p>In my <code>worker.js</code> script, I wrote my instructions in a function called <code>onmessage</code>. The worker receives data through the <code>event</code> parameter and runs heavy calculations that do not require interacting with the DOM. It would send back data to my <code>main.js</code> script using <code>postMessage()</code>.</p><div class=highlight><pre style=color:#272822;background-color:#fafafa;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-javascript data-lang=javascript><span style=color:#75af00>importScripts</span><span style=color:#111>(</span><span style=color:#d88200>&#34;https://d3js.org/d3.v6.min.js&#34;</span><span style=color:#111>);</span>

<span style=color:#75af00>onmessage</span> <span style=color:#f92672>=</span> <span style=color:#111>(</span><span style=color:#75af00>event</span><span style=color:#111>)</span> <span style=color:#111>=&gt;</span> <span style=color:#111>{</span>

    <span style=color:#75715e>// Calculate Simulation which alters event.data.nodes and event.data.links
</span><span style=color:#75715e></span>
    <span style=color:#75715e>// Post message back
</span><span style=color:#75715e></span>    <span style=color:#75af00>postMessage</span><span style=color:#111>({</span>
        <span style=color:#75af00>nodes</span><span style=color:#f92672>:</span> <span style=color:#75af00>event</span><span style=color:#111>.</span><span style=color:#75af00>data</span><span style=color:#111>.</span><span style=color:#75af00>nodes</span><span style=color:#111>,</span> 
        <span style=color:#75af00>links</span><span style=color:#f92672>:</span> <span style=color:#75af00>event</span><span style=color:#111>.</span><span style=color:#75af00>data</span><span style=color:#111>.</span><span style=color:#75af00>links</span><span style=color:#111>,</span>
    <span style=color:#111>});</span>
<span style=color:#111>}</span>
</code></pre></div><p>Web Workers are really magical. They cut my rendering from approximately 6 seconds to 2 seconds. I would recommend them if you&rsquo;re trying to create a <strong>static</strong> chart that requires a simulation to determine every object&rsquo;s placement.</p><h3 id=hovering-with-tooltip>Hovering with Tooltip</h3><p>I used a nested <code>&lt;div></code> structure for my tooltip and SVG.</p><div class=highlight><pre style=color:#272822;background-color:#fafafa;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-html data-lang=html><span style=color:#111>&lt;</span><span style=color:#f92672>div</span> <span style=color:#75af00>id</span><span style=color:#f92672>=</span><span style=color:#d88200>&#34;chart&#34;</span><span style=color:#111>&gt;</span>
	<span style=color:#111>&lt;</span><span style=color:#f92672>svg</span><span style=color:#111>&gt;</span>...<span style=color:#111>&lt;/</span><span style=color:#f92672>svg</span><span style=color:#111>&gt;</span>
	<span style=color:#111>&lt;</span><span style=color:#f92672>div</span> <span style=color:#75af00>id</span><span style=color:#f92672>=</span><span style=color:#d88200>&#34;tooltip&#34;</span><span style=color:#111>&gt;</span>
		...
	<span style=color:#111>&lt;/</span><span style=color:#f92672>div</span><span style=color:#111>&gt;</span>
<span style=color:#111>&lt;/</span><span style=color:#f92672>div</span><span style=color:#111>&gt;</span>
</code></pre></div><p>Usually when I hover over an object, I would place the tooltip object near my mouse by using the object&rsquo;s x and y coordinates as a proxy. I <em>thiiiiiink</em> I had trouble implementing it because I was hovering over an image, so if I were to use <code>d3.select(this)</code> as I normally would, I would get <code>null</code>.</p><p>I looked up how to get my mouse&rsquo;s coordinates instead of relying on the object, and those <a href=https://stackoverflow.com/questions/6073505/what-is-the-difference-between-screenx-y-clientx-y-and-pagex-y>solutions</a> exist! I used the mouse event&rsquo;s <code>pageX</code> and <code>pageY</code> coordinates. Note that it&rsquo;s passed as the first argument, while the data is passed as the second with D3&rsquo;s <code>.on</code>.</p><div class=highlight><pre style=color:#272822;background-color:#fafafa;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-javascript data-lang=javascript><span style=color:#111>.</span><span style=color:#75af00>on</span><span style=color:#111>(</span><span style=color:#d88200>&#34;mouseover&#34;</span><span style=color:#111>,</span> <span style=color:#111>(</span><span style=color:#75af00>e</span><span style=color:#111>,</span> <span style=color:#75af00>d</span><span style=color:#111>)</span> <span style=color:#111>=&gt;</span> <span style=color:#111>{</span>

    <span style=color:#75715e>// Update position
</span><span style=color:#75715e></span>    <span style=color:#00a8c8>let</span> <span style=color:#75af00>xPosition</span> <span style=color:#f92672>=</span> <span style=color:#75af00>e</span><span style=color:#111>.</span><span style=color:#75af00>pageX</span> <span style=color:#f92672>+</span> <span style=color:#75af00>tooltipPadding</span><span style=color:#111>,</span>
        <span style=color:#75af00>yPosition</span> <span style=color:#f92672>=</span> <span style=color:#75af00>e</span><span style=color:#111>.</span><span style=color:#75af00>pageY</span> <span style=color:#f92672>+</span> <span style=color:#75af00>tooltipPadding</span><span style=color:#111>;</span>

    <span style=color:#75715e>// Do your thing
</span><span style=color:#75715e></span><span style=color:#111>}</span>
</code></pre></div><p>Now we have a working tooltip with colored links indicating wins and losses!</p><p><img src=tooltip.png alt></p></div><footer><div class=footer-inner><div class=footer-inner-left><div class=icons><a href=mailto:sarinarchen@gmail.com><svg width="16" height="14" viewBox="0 0 16 14" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink"><title>email</title><g class="portfolio-contact" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g transform="translate(-94.000000, -336.000000)" id="Group" fill="#505050"><g transform="translate(94.000000, 335.000000)"><g id="ui-16px-1_email-84" transform="translate(0.000000, 1.000000)"><path d="M15 0H1C.448.0.0.447.0 1V13C0 13.553.448 14 1 14H15C15.552 14 16 13.553 16 13V1C16 .447 15.552.0 15 0zM14 12H2V5.723L7.504 8.868C7.812 9.044 8.189 9.044 8.496 8.868L14 5.723V12zm0-8.58L8 6.849 2 3.42V2H14V3.42z" id="Shape"/></g></g></g></g></svg></a><a href=https://www.linkedin.com/in/sarinachen/ target=blank><svg width="17" height="16" viewBox="0 0 17 16" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink"><title>linkedin</title><g class="portfolio-contact" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g transform="translate(-243.000000, -335.000000)" id="Group" fill="#505050"><g transform="translate(94.000000, 335.000000)"><g id="social-16px_logo-linkedin" transform="translate(149.000000, 0.000000)"><path d="M15.3.0H.7C.3.0.0.3.0.7V15.4C0 15.7.3 16 .7 16H15.4C15.8 16 16.1 15.7 16.1 15.3V.7C16 .3 15.7.0 15.3.0zM4.7 13.6H2.4V6H4.8v7.6H4.7zM3.6 5C2.8 5 2.2 4.3 2.2 3.6 2.2 2.8 2.8 2.2 3.6 2.2S5 2.8 5 3.6C4.9 4.3 4.3 5 3.6 5zm10 8.6H11.2V9.9C11.2 9 11.2 7.9 10 7.9S8.6 8.9 8.6 9.9V13.7H6.2V6H8.5V7C8.8 6.4 9.6 5.8 10.7 5.8 13.1 5.8 13.5 7.4 13.5 9.4V13.6H13.6z" id="Shape"/></g></g></g></g></svg></a><a href=https://github.com/sarinac target=blank><svg width="17" height="17" viewBox="0 0 17 17" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><title>github</title><g class="portfolio-contact" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="GitHub-Mark" transform="translate(-136.000000, -55.000000)" fill="#505050"><path d="M144.319263 55.455C139.902185 55.455 136.32 59.0366937 136.32 63.4552456 136.32 66.9897924 138.612029 69.9880428 141.791009 71.0459021 142.191267 71.1195692 142.337128 70.8725389 142.337128 70.6603777 142.337128 70.4708077 142.330252 69.967416 142.326323 69.2999922 140.101086 69.7832483 139.631581 68.2273994 139.631581 68.2273994 139.267666 67.303123 138.743156 67.057075 138.743156 67.057075 138.016799 66.5610499 138.798161 66.5708722 138.798161 66.5708722 139.601132 66.6273503 140.02349 67.3954524 140.02349 67.3954524 140.737078 68.617835 141.896107 68.2647241 142.351861 68.0599296 142.424546 67.5432777 142.631305 67.1906579 142.859673 66.9907746 141.083314 66.7889268 139.215608 66.1023495 139.215608 63.0368165 139.215608 62.163616 139.527465 61.4490452 140.039206 60.8901576 139.956698 60.6878187 139.682166 59.8740429 140.117784 58.7729656 140.117784 58.7729656 140.789137 58.5578577 142.317483 59.5931258 142.95544 59.4153426 143.640053 59.326942 144.320246 59.3235043 144.999947 59.326942 145.684069 59.4153426 146.323008 59.5931258 147.850372 58.5578577 148.520743 58.7729656 148.520743 58.7729656 148.957343 59.8740429 148.68281 60.6878187 148.600794 60.8901576 149.113517 61.4490452 149.422919 62.163616 149.422919 63.0368165 149.422919 66.1102073 147.552266 66.7864712 145.770505 66.9843901 146.057315 67.2314204 146.313186 67.7195876 146.313186 68.4660808 146.313186 69.5352357 146.303364 70.3981229 146.303364 70.6603777 146.303364 70.8745034 146.447751 71.1234981 146.853411 71.045411 150.029936 69.9850961 152.32 66.9888101 152.32 63.4552456 152.32 59.0366937 148.737815 55.455 144.319263 55.455" id="Fill-4"/></g></g></svg></a></div></div><div class=footer-inner-center><p>I created my website with <a href=https://gohugo.io/>Hugo</a>.</p></div><div class=footer-inner-right><p><a href=https://ifcolorful.com/>Sarina Chen</a></p></div></div><script src=https://ifcolorful.com/js/jquery-1.js></script><script src=https://ifcolorful.com/js/stickUp.js></script><script src=https://ifcolorful.com/js/scrollIt.js type=text/javascript></script><script type=text/javascript>jQuery(function($){$(document).ready(function(){$('.main-navigation').stickUp({});});});$(function(){$.scrollIt({topOffset:-70,easing:'ease-in-out'});});</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-YQC37FT3TK"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}
gtag('js',new Date());gtag('config','G-YQC37FT3TK');</script></footer></body></html>